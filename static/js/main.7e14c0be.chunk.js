(this["webpackJsonpsocket-meet"]=this["webpackJsonpsocket-meet"]||[]).push([[0],{72:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),c=t(9),i=t.n(c),s=t(13),u=t(11),o=t(17),d=t.n(o),l=t(29),j=t(26),f=t(116),O=t(115),b=t(100),h=t(104),p=t(113),E=t(111),_=t(107),x=t(108),R=t(109),T=t(110),m={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},N=new WebSocket("wss://p2p-be-dev.janus-demo.live"),v={JOIN_LOBBY:"JOIN_LOBBY",JOIN_LOBBY_ACK:"JOIN_LOBBY_ACK",GET_PEER_LIST:"GET_PEER_LIST",GET_PEER_LIST_ACK:"GET_PEER_LIST_ACK",PEER_LIST_CHANGED:"PEER_LIST_CHANGED",GET_STUN_TURN_INFO:"GET_STUN_TURN_INFO",GET_STUN_TURN_INFO_ACK:"GET_STUN_TURN_INFO_ACK",WEBRTC_OFFER:"WEBRTC_OFFER",WEBRTC_ANSWER:"WEBRTC_ANSWER",ICE_CANDIDATE:"ICE_CANDIDATE",CALL_STARTED:"CALL_STARTED",HANG_UP:"HANG_UP"},C=t(103),g=t(105),S=t(106),A=t(6),y=function(e){var n=e.users,t=e.myName,r=e.onSelectRecipient;return Object(A.jsx)(b.a,{container:!0,spacing:2,children:n.map((function(e){var n=e.name,a=e.status;return t===n?null:Object(A.jsx)(b.a,{item:!0,xs:"auto",children:Object(A.jsx)(C.a,{badgeContent:"ONLINE"===a?"online":"offline",color:"ONLINE"===a?"primary":"secondary",children:Object(A.jsx)(h.a,{style:{borderRadius:8},onClick:function(){return r(n)},children:Object(A.jsx)(g.a,{component:O.a,p:2,children:Object(A.jsx)(S.a,{children:n})})})})},n)}))})},I={variant:"contained",color:"primary"},B="test",L=function(){var e=a.a.useRef(null),n=a.a.useRef(null),t=a.a.useRef(null),r=a.a.useRef(null),c=a.a.useRef(null),i=a.a.useRef([]),o=a.a.useRef(null),O=a.a.useState("".concat(B,"@").concat(Object(f.a)().slice(0,4))),b=Object(j.a)(O,2),h=b[0],p=b[1],E=a.a.useState([]),_=Object(j.a)(E,2),x=_[0],R=_[1],T=a.a.useState({video:!0,audio:!0}),C=Object(j.a)(T,2),g=C[0],S=C[1],A=a.a.useState({join:!1,call:!0,hungUp:!0}),y=Object(j.a)(A,2),I=y[0],L=y[1],k=function(){var e=Object(l.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 2:if(t=e.sent,i.current.length){e.next=5;break}return e.abrupt("return");case 5:i.current.find((function(e){return!Boolean(e.srcObject)})).srcObject=t,n.current=t;case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){e.current.ontrack=null,e.current.onicecandidate=null,e.current.close();var n={type:v.HANG_UP,data:"",sender:h,recipient:o.current};N.send(JSON.stringify(n)),L((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!1,hungUp:!0})}))},D=function(){var t=Object(l.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.current=new RTCPeerConnection(m),L((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!0,hungUp:!1})})),n.current.getTracks().forEach((function(t){return e.current.addTrack(t,n.current)})),e.current.addEventListener("icecandidate",(function(e){var n=e.candidate;if(n){var t={type:v.ICE_CANDIDATE,data:n,sender:h,recipient:o.current};N.send(JSON.stringify(t))}})),e.current.addEventListener("track",(function(e){if(i.current.length){var n=i.current.find((function(e){return!Boolean(e.srcObject)})),t=Object(j.a)(e.streams,1)[0];n.srcObject=t}}));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),F=function(){var n=Object(l.a)(d.a.mark((function n(t){var r,a;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return D(),n.next=3,e.current.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!0});case 3:return r=n.sent,n.next=6,e.current.setLocalDescription(r);case 6:a={type:v.WEBRTC_OFFER,data:r,sender:h,recipient:t},N.send(JSON.stringify(a)),L((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!0})}));case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return a.a.useEffect((function(){N.addEventListener("message",function(){var n=Object(l.a)(d.a.mark((function n(t){var r,a,c,i,s,u,l,j;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=JSON.parse(t.data),a=r.type,c=r.data,i=r.sender,s=r.recipient,a===v.PEER_LIST_CHANGED&&(u=c.users.filter((function(e){return e.name.includes(B)})),R((function(e){var n=e.find((function(e){return e.name===h})),t=u.find((function(e){return e.name===h}));return!n&&t&&setTimeout((function(){k().then((function(){e.forEach((function(e){var n=e.name;return F(n)}))}))}),1e3),u}))),a!==v.WEBRTC_OFFER||i===h){n.next=14;break}return D(),o.current=i,n.next=7,e.current.setRemoteDescription(c);case 7:return n.next=9,e.current.createAnswer();case 9:return l=n.sent,n.next=12,e.current.setLocalDescription(l);case 12:j={type:v.WEBRTC_ANSWER,data:l,sender:s,recipient:i},N.send(JSON.stringify(j));case 14:if(a!==v.WEBRTC_ANSWER||i===h){n.next=17;break}return n.next=17,e.current.setRemoteDescription(c);case 17:a===v.ICE_CANDIDATE&&i!==h&&e.current.addIceCandidate(c),a===v.HANG_UP&&i!==h&&U();case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}),[]),{senderName:h,handleChangeSenderName:function(e){return p(e.target.value)},handleSelectRecipient:function(e){o.current=e,L((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!1})}))},localVideoRef:t,remoteVideoRef:r,anotherVideoRef:c,handleAddVideoRef:function(e){e&&!i.current.includes(e)&&i.current.push(e)},disableButtons:I,isVideoOn:g.video,isAudioOn:g.audio,handleToggleDevicesMuteStatus:function(e){return function(){return S((function(t){var r=Object(u.a)(Object(u.a)({},t),{},Object(s.a)({},e,!t[e]));return n.current.getTracks().forEach((function(n){n.kind===e&&(n.enabled=!n.enabled)})),r}))}},joinedUsers:x,handleCall:F,handleHungUp:U,handleJoinLobby:function(){var e={type:v.JOIN_LOBBY,data:"",sender:h,recipient:""};N.send(JSON.stringify(e)),L((function(e){return Object(u.a)(Object(u.a)({},e),{},{join:!0,hungUp:!0})}))}}},k=function(){var e=L(),n=12/(e.joinedUsers.length||1);return Object(A.jsxs)(O.a,{p:2,children:[Object(A.jsxs)(b.a,{container:!0,spacing:2,justify:"center",children:[e.joinedUsers.map((function(t){return Object(A.jsx)(b.a,{item:!0,xs:n,children:Object(A.jsx)("video",{autoPlay:!0,ref:e.handleAddVideoRef,style:{width:"100%",height:"100%"}})},t.name)})),Object(A.jsxs)(b.a,{item:!0,xs:12,container:!0,spacing:2,justify:"center",children:[Object(A.jsx)(b.a,{item:!0,xs:"auto",children:Object(A.jsx)(h.a,{onClick:e.handleToggleDevicesMuteStatus("video"),children:e.isVideoOn?Object(A.jsx)(_.a,{color:"primary"}):Object(A.jsx)(x.a,{color:"error"})})}),Object(A.jsx)(b.a,{item:!0,xs:"auto",children:Object(A.jsx)(h.a,{onClick:e.handleToggleDevicesMuteStatus("audio"),children:e.isAudioOn?Object(A.jsx)(R.a,{color:"primary"}):Object(A.jsx)(T.a,{color:"error"})})})]}),Object(A.jsx)(b.a,{item:!0,xs:12,children:Object(A.jsx)(p.a,{value:e.senderName,onChange:e.handleChangeSenderName,variant:"outlined",fullWidth:!0,autoFocus:!0,disabled:e.disableButtons.join})}),Object(A.jsx)(b.a,{item:!0,xs:"auto",children:Object(A.jsx)(E.a,Object(u.a)(Object(u.a)({},I),{},{onClick:e.handleCall,disabled:e.disableButtons.call,children:"Call"}))}),Object(A.jsx)(b.a,{item:!0,xs:"auto",children:Object(A.jsx)(E.a,Object(u.a)(Object(u.a)({},I),{},{onClick:e.handleJoinLobby,disabled:e.disableButtons.join,children:e.disableButtons.join?"Joined":"Join"}))}),Object(A.jsx)(b.a,{item:!0,xs:"auto",children:Object(A.jsx)(E.a,Object(u.a)(Object(u.a)({},I),{},{onClick:e.handleHungUp,disabled:e.disableButtons.hungUp,children:"Hung up"}))})]}),Object(A.jsx)(y,{users:e.joinedUsers,myName:e.senderName,onSelectRecipient:e.handleSelectRecipient})]})},U=t(112),D=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,119)).then((function(n){var t=n.getCLS,r=n.getFID,a=n.getFCP,c=n.getLCP,i=n.getTTFB;t(e),r(e),a(e),c(e),i(e)}))};t(71);i.a.render(Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(U.a,{}),Object(A.jsx)(k,{})]}),document.getElementById("root")),D()}},[[72,1,2]]]);
//# sourceMappingURL=main.7e14c0be.chunk.js.map
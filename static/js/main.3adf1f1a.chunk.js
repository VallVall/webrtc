(this["webpackJsonpsocket-meet"]=this["webpackJsonpsocket-meet"]||[]).push([[0],{71:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(9),i=t.n(c),s=t(12),o=t(16),u=t(20),d=t.n(u),l=t(37),j=t(21),O=t(116),f=t(100),b=t(103),h=t(104),p=t(105),E=t(115),x=t(106),m=t(113),N=t(111),_=t(107),T=t(108),C=t(109),R=t(110),v=t(6),g=new WebSocket("wss://p2p-be-dev.janus-demo.live"),S={JOIN_LOBBY:"JOIN_LOBBY",JOIN_LOBBY_ACK:"JOIN_LOBBY_ACK",GET_PEER_LIST:"GET_PEER_LIST",GET_PEER_LIST_ACK:"GET_PEER_LIST_ACK",PEER_LIST_CHANGED:"PEER_LIST_CHANGED",GET_STUN_TURN_INFO:"GET_STUN_TURN_INFO",GET_STUN_TURN_INFO_ACK:"GET_STUN_TURN_INFO_ACK",WEBRTC_OFFER:"WEBRTC_OFFER",WEBRTC_ANSWER:"WEBRTC_ANSWER",ICE_CANDIDATE:"ICE_CANDIDATE",CALL_STARTED:"CALL_STARTED",HANG_UP:"HANG_UP"},A=function(e){var n=e.users,t=e.myName,a=e.onSelectRecipient;return Object(v.jsx)(f.a,{container:!0,spacing:2,children:n.map((function(e){var n=e.name,r=e.status;return t===n?null:Object(v.jsx)(f.a,{item:!0,xs:"auto",children:Object(v.jsx)(b.a,{badgeContent:"ONLINE"===r?"online":"offline",color:"ONLINE"===r?"primary":"secondary",children:Object(v.jsx)(h.a,{style:{borderRadius:8},onClick:function(){return a(n)},children:Object(v.jsx)(p.a,{component:E.a,p:2,children:Object(v.jsx)(x.a,{children:n})})})})},n)}))})},y={variant:"contained",color:"primary"},I=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),L=function(){var e=r.a.useRef(null),n=r.a.useRef(null),t=r.a.useRef(null),a=r.a.useState("".concat(Object(O.a)().slice(0,4),"@").concat(Object(O.a)().slice(0,4))),c=Object(j.a)(a,2),i=c[0],u=c[1],f=r.a.useState(""),b=Object(j.a)(f,2),h=b[0],p=b[1],E=r.a.useState(null),x=Object(j.a)(E,2),m=x[0],N=x[1],_=r.a.useState([]),T=Object(j.a)(_,2),C=T[0],R=T[1],v=r.a.useState({video:!0,audio:!0}),A=Object(j.a)(v,2),y=A[0],L=A[1],k=function(){var n=Object(l.a)(d.a.mark((function n(){var t;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 2:if(t=n.sent,N(t),e.current){n.next=6;break}return n.abrupt("return");case 6:t.getTracks().forEach((function(e){console.log(e.getSettings()),I.addTrack(e,t)})),e.current.srcObject=t;case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),B=function(){var e=Object(l.a)(d.a.mark((function e(){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!0});case 2:return n=e.sent,e.next=5,I.setLocalDescription(n);case 5:a={type:S.WEBRTC_OFFER,data:n,sender:i,recipient:h},t.current=h,g.send(JSON.stringify(a));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){n.current.srcObject.getTracks().forEach((function(e){return e.stop()})),e.current.srcObject.getTracks().forEach((function(e){return e.stop()})),I.close()},F=function(){I.addEventListener("icecandidate",(function(e){var n=e.candidate;if(n){var a={type:S.ICE_CANDIDATE,data:n,sender:i,recipient:t.current};g.send(JSON.stringify(a))}})),I.addEventListener("track",(function(e){if(n.current){var t=Object(j.a)(e.streams,1)[0];n.current.srcObject!==t&&(n.current.srcObject=t)}})),I.addEventListener("iceconnectionstatechange",(function(){"disconnected"===I.iceConnectionState&&(D(),I.ontrack=null,I.onicecandidate=null)}))};return r.a.useEffect((function(){k().then(F),g.addEventListener("message",function(){var e=Object(l.a)(d.a.mark((function e(n){var a,r,c,s,o,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=JSON.parse(n.data),r=a.type,c=a.data,s=a.sender,o=a.recipient,r===S.PEER_LIST_CHANGED&&R(c.users),r!==S.WEBRTC_OFFER||s===i){e.next=13;break}return t.current=s,e.next=6,I.setRemoteDescription(c);case 6:return e.next=8,I.createAnswer();case 8:return u=e.sent,e.next=11,I.setLocalDescription(u);case 11:l={type:S.WEBRTC_ANSWER,data:u,sender:o,recipient:s},g.send(JSON.stringify(l));case 13:if(r!==S.WEBRTC_ANSWER||s===i){e.next=16;break}return e.next=16,I.setRemoteDescription(c);case 16:r===S.ICE_CANDIDATE&&s!==i&&I.addIceCandidate(c);case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())}),[]),{peer:I,senderName:i,handleChangeSenderName:function(e){return u(e.target.value)},recipientName:h,handleSelectRecipient:function(e){return p(e)},localVideoRef:e,remoteVideoRef:n,isVideoOn:y.video,isAudioOn:y.audio,handleToggleDevicesMuteStatus:function(e){return function(){return L((function(n){var t=Object(o.a)(Object(o.a)({},n),{},Object(s.a)({},e,!n[e]));return m.getTracks().forEach((function(n){n.kind===e&&(n.enabled=!n.enabled)})),t}))}},localeStream:m,joinedUsers:C,handleCall:B,handleHungUp:D,handleJoinLobby:function(){var e={type:S.JOIN_LOBBY,data:"",sender:i,recipient:""};g.send(JSON.stringify(e))}}},k=function(){var e=L();return Object(v.jsxs)(E.a,{p:2,children:[Object(v.jsxs)(f.a,{container:!0,spacing:2,justify:"center",children:[Object(v.jsxs)(f.a,{item:!0,xs:6,children:["11111",Object(v.jsx)("video",{autoPlay:!0,ref:e.localVideoRef,style:{width:"100%",height:"100%"}})]}),Object(v.jsx)(f.a,{item:!0,xs:6,children:Object(v.jsx)("video",{autoPlay:!0,ref:e.remoteVideoRef,style:{width:"100%",height:"100%"}})}),Object(v.jsxs)(f.a,{item:!0,xs:12,container:!0,spacing:2,justify:"center",children:[Object(v.jsx)(f.a,{item:!0,xs:"auto",children:Object(v.jsx)(h.a,{onClick:e.handleToggleDevicesMuteStatus("video"),children:e.isVideoOn?Object(v.jsx)(_.a,{color:"primary"}):Object(v.jsx)(T.a,{color:"error"})})}),Object(v.jsx)(f.a,{item:!0,xs:"auto",children:Object(v.jsx)(h.a,{onClick:e.handleToggleDevicesMuteStatus("audio"),children:e.isAudioOn?Object(v.jsx)(C.a,{color:"primary"}):Object(v.jsx)(R.a,{color:"error"})})})]}),Object(v.jsx)(f.a,{item:!0,xs:12,children:Object(v.jsx)(m.a,{value:e.senderName,onChange:e.handleChangeSenderName,variant:"outlined",fullWidth:!0,autoFocus:!0,disabled:Boolean(e.joinedUsers.find((function(n){return n.name===e.senderName})))})}),Object(v.jsx)(f.a,{item:!0,xs:"auto",children:Object(v.jsxs)(N.a,Object(o.a)(Object(o.a)({},y),{},{onClick:e.handleCall,disabled:!e.recipientName,children:["Call ",e.recipientName&&"to ".concat(e.recipientName)]}))}),Object(v.jsx)(f.a,{item:!0,xs:"auto",children:Object(v.jsx)(N.a,Object(o.a)(Object(o.a)({},y),{},{onClick:e.handleJoinLobby,disabled:!e.senderName||Boolean(e.joinedUsers.find((function(n){return n.name===e.senderName}))),children:Boolean(e.joinedUsers.find((function(n){return n.name===e.senderName})))?"Joined":"Join"}))}),Object(v.jsx)(f.a,{item:!0,xs:"auto",children:Object(v.jsx)(N.a,Object(o.a)(Object(o.a)({},y),{},{onClick:e.handleHungUp,children:"Hung up"}))})]}),Object(v.jsx)(A,{users:e.joinedUsers,myName:e.senderName,onSelectRecipient:e.handleSelectRecipient})]})},B=t(112),D=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,119)).then((function(n){var t=n.getCLS,a=n.getFID,r=n.getFCP,c=n.getLCP,i=n.getTTFB;t(e),a(e),r(e),c(e),i(e)}))};t(70);i.a.render(Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(B.a,{}),Object(v.jsx)(k,{})]}),document.getElementById("root")),D()}},[[71,1,2]]]);
//# sourceMappingURL=main.3adf1f1a.chunk.js.map
(this["webpackJsonpsocket-meet"]=this["webpackJsonpsocket-meet"]||[]).push([[0],{78:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(9),i=n.n(c),s=n(34),o=n(24),d=n.n(o),u=n(44),l=n(13),j=n(122),O=(n(119),n(125),n(121)),f=n(113),b=n(123),E=n(114),p=n(115),_=n(116),N=n(112),h=n(117),m=(n(77),new WebSocket("wss://p2p-be-dev.janus-demo.live")),T={JOIN_LOBBY:"JOIN_LOBBY",JOIN_LOBBY_ACK:"JOIN_LOBBY_ACK",GET_PEER_LIST:"GET_PEER_LIST",GET_PEER_LIST_ACK:"GET_PEER_LIST_ACK",PEER_LIST_CHANGED:"PEER_LIST_CHANGED",GET_STUN_TURN_INFO:"GET_STUN_TURN_INFO",GET_STUN_TURN_INFO_ACK:"GET_STUN_TURN_INFO_ACK",WEBRTC_OFFER:"WEBRTC_OFFER",WEBRTC_ANSWER:"WEBRTC_ANSWER",ICE_CANDIDATE:"ICE_CANDIDATE",CALL_STARTED:"CALL_STARTED",HANG_UP:"HANG_UP"},C=n(8),R={variant:"contained",color:"primary"},v=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),x=function(){var e=r.a.useRef(null),t=r.a.useRef(null),n=r.a.useRef(null),a=r.a.useState("".concat(Object(j.a)().slice(0,4),"@").concat(Object(j.a)().slice(0,4))),c=Object(l.a)(a,2),i=c[0],s=c[1],o=r.a.useState(""),O=Object(l.a)(o,2),f=O[0],b=O[1],E=r.a.useState(null),p=Object(l.a)(E,2),_=p[0],N=p[1],h=r.a.useState([]),C=Object(l.a)(h,2),R=C[0],x=(C[1],r.a.useState([])),S=Object(l.a)(x,2),I=S[0],A=(S[1],r.a.useState([])),g=Object(l.a)(A,2),L=g[0],y=(g[1],r.a.useState([])),B=Object(l.a)(y,2),D=B[0],F=B[1],k=function(){var t=Object(u.a)(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({video:!0});case 2:if(n=t.sent,N(n),e.current){t.next=6;break}return t.abrupt("return");case 6:n.getTracks().forEach((function(e){v.addTrack(e,n)})),e.current.srcObject=n;case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),J=function(){var e=Object(u.a)(d.a.mark((function e(){var t,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.createOffer({offerToReceiveVideo:!0});case 2:return t=e.sent,e.next=5,v.setLocalDescription(t);case 5:a={type:T.WEBRTC_OFFER,data:t,sender:i,recipient:f},n.current=f,m.send(JSON.stringify(a));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.useEffect((function(){v.addEventListener("icecandidate",(function(e){var t=e.candidate;if(t){var a={type:T.ICE_CANDIDATE,data:t,sender:i,recipient:n.current};m.send(JSON.stringify(a))}})),v.addEventListener("track",(function(e){var n=e.streams;if(t.current){var a=Object(l.a)(n,1)[0];t.current.srcObject!==a&&(t.current.srcObject=a)}})),k(),m.addEventListener("message",function(){var e=Object(u.a)(d.a.mark((function e(t){var a,r,c,s,o,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=JSON.parse(t.data),r=a.type,c=a.data,s=a.sender,o=a.recipient,r===T.PEER_LIST_CHANGED&&F(c.users),r!==T.WEBRTC_OFFER||s===i){e.next=13;break}return n.current=s,e.next=6,v.setRemoteDescription(c);case 6:return e.next=8,v.createAnswer();case 8:return u=e.sent,e.next=11,v.setLocalDescription(u);case 11:l={type:T.WEBRTC_ANSWER,data:u,sender:o,recipient:s},m.send(JSON.stringify(l));case 13:if(r!==T.WEBRTC_ANSWER||s===i){e.next=16;break}return e.next=16,v.setRemoteDescription(c);case 16:console.log(r),r===T.ICE_CANDIDATE&&v.addIceCandidate(c);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),{peer:v,senderName:i,handleChangeSenderName:function(e){return s(e.target.value)},recipientName:f,handleSelectRecipient:function(e){return b(e)},videoRef:e,remoteVideoRef:t,localeStream:_,videoDevices:R,microphoneDevices:I,volumeDevices:L,joinedUsers:D,handleCall:J,handleJoinLobby:function(){var e={type:T.JOIN_LOBBY,data:"",sender:i,recipient:""};m.send(JSON.stringify(e))}}},S=function(){var e=x();return Object(C.jsxs)(O.a,{p:2,children:[Object(C.jsxs)(f.a,{container:!0,spacing:2,children:[Object(C.jsx)(f.a,{item:!0,xs:6,children:Object(C.jsx)("video",{autoPlay:!0,ref:e.videoRef,style:{width:"100%",height:"100%"}})}),Object(C.jsx)(f.a,{item:!0,xs:6,children:Object(C.jsx)("video",{autoPlay:!0,ref:e.remoteVideoRef,style:{width:"100%",height:"100%"}})}),Object(C.jsx)(f.a,{item:!0,xs:12,children:Object(C.jsx)(b.a,{value:e.senderName,onChange:e.handleChangeSenderName,variant:"outlined",fullWidth:!0,autoFocus:!0,disabled:Boolean(e.joinedUsers.find((function(t){return t.name===e.senderName})))})}),Object(C.jsx)(f.a,{item:!0,xs:"auto",children:Object(C.jsxs)(E.a,Object(s.a)(Object(s.a)({},R),{},{onClick:e.handleCall,disabled:!e.recipientName,children:["Call ",e.recipientName&&"to ".concat(e.recipientName)]}))}),Object(C.jsx)(f.a,{item:!0,xs:"auto",children:Object(C.jsx)(E.a,Object(s.a)(Object(s.a)({},R),{},{onClick:e.handleJoinLobby,disabled:!e.senderName||Boolean(e.joinedUsers.find((function(t){return t.name===e.senderName}))),children:Boolean(e.joinedUsers.find((function(t){return t.name===e.senderName})))?"Joined":"Join"}))})]}),Object(C.jsx)(f.a,{container:!0,spacing:2,children:e.joinedUsers.map((function(t){var n=t.name,a=t.status;return e.senderName===n?null:Object(C.jsx)(f.a,{item:!0,xs:"auto",children:Object(C.jsx)(p.a,{badgeContent:"ONLINE"===a?"online":"offline",color:"ONLINE"===a?"primary":"secondary",children:Object(C.jsx)(_.a,{style:{borderRadius:8},onClick:function(){return e.handleSelectRecipient(n)},children:Object(C.jsx)(N.a,{component:O.a,p:2,children:Object(C.jsx)(h.a,{children:n})})})})},n)}))})]})},I=n(118),A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,127)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};i.a.render(Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)(I.a,{}),Object(C.jsx)(S,{})]}),document.getElementById("root")),A()}},[[78,1,2]]]);
//# sourceMappingURL=main.cd6d6d71.chunk.js.map
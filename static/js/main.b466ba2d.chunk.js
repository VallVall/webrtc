(this["webpackJsonpsocket-meet"]=this["webpackJsonpsocket-meet"]||[]).push([[0],{72:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(9),i=n.n(a),s=n(13),u=n(11),o=n(17),d=n.n(o),l=n(29),j=n(26),O=n(116),b=n(115),f=n(100),h=n(104),p=n(113),x=n(111),E=n(107),_=n(108),R=n(109),T=n(110),N={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},v=new WebSocket("wss://p2p-be-dev.janus-demo.live"),m={JOIN_LOBBY:"JOIN_LOBBY",JOIN_LOBBY_ACK:"JOIN_LOBBY_ACK",GET_PEER_LIST:"GET_PEER_LIST",GET_PEER_LIST_ACK:"GET_PEER_LIST_ACK",PEER_LIST_CHANGED:"PEER_LIST_CHANGED",GET_STUN_TURN_INFO:"GET_STUN_TURN_INFO",GET_STUN_TURN_INFO_ACK:"GET_STUN_TURN_INFO_ACK",WEBRTC_OFFER:"WEBRTC_OFFER",WEBRTC_ANSWER:"WEBRTC_ANSWER",ICE_CANDIDATE:"ICE_CANDIDATE",CALL_STARTED:"CALL_STARTED",HANG_UP:"HANG_UP"},C=n(103),g=n(105),S=n(106),y=n(6),A=function(e){var t=e.users,n=e.myName,r=e.onSelectRecipient;return Object(y.jsx)(f.a,{container:!0,spacing:2,children:t.map((function(e){var t=e.name,c=e.status;return n===t?null:Object(y.jsx)(f.a,{item:!0,xs:"auto",children:Object(y.jsx)(C.a,{badgeContent:"ONLINE"===c?"online":"offline",color:"ONLINE"===c?"primary":"secondary",children:Object(y.jsx)(h.a,{style:{borderRadius:8},onClick:function(){return r(t)},children:Object(y.jsx)(g.a,{component:b.a,p:2,children:Object(y.jsx)(S.a,{children:t})})})})},t)}))})},I={variant:"contained",color:"primary"},L="test",B=function(){var e=c.a.useRef(null),t=c.a.useRef(null),n=c.a.useRef(null),r=c.a.useRef(null),a=c.a.useRef(null),i=c.a.useRef(null),o=c.a.useState("".concat(L,"@").concat(Object(O.a)().slice(0,4))),b=Object(j.a)(o,2),f=b[0],h=b[1],p=c.a.useState([]),x=Object(j.a)(p,2),E=x[0],_=x[1],R=c.a.useState({video:!0,audio:!0}),T=Object(j.a)(R,2),C=T[0],g=T[1],S=c.a.useState({join:!1,call:!0,hungUp:!0}),y=Object(j.a)(S,2),A=y[0],I=y[1],B=function(){var e=Object(l.a)(d.a.mark((function e(){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0,audio:!1});case 2:if(r=e.sent,n.current){e.next=5;break}return e.abrupt("return");case 5:n.current.srcObject=r,t.current=r;case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){e.current.ontrack=null,e.current.onicecandidate=null,e.current.close();var t={type:m.HANG_UP,data:"",sender:f,recipient:i.current};v.send(JSON.stringify(t)),I((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!1,hungUp:!0})}))},D=function(){var n=Object(l.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.current=new RTCPeerConnection(N),I((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!0,hungUp:!1})})),t.current.getTracks().forEach((function(n){return e.current.addTrack(n,t.current)})),e.current.addEventListener("icecandidate",(function(e){var t=e.candidate;if(t){var n={type:m.ICE_CANDIDATE,data:t,sender:f,recipient:i.current};v.send(JSON.stringify(n))}})),e.current.addEventListener("track",(function(e){if(r.current){var t=Object(j.a)(e.streams,1)[0];r.current.srcObject!==t&&(r.current.srcObject?a.current.srcObject||(a.current.srcObject=t):r.current.srcObject=t)}}));case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),U=function(){var t=Object(l.a)(d.a.mark((function t(){var n,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return D(),t.next=3,e.current.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!0});case 3:return n=t.sent,t.next=6,e.current.setLocalDescription(n);case 6:r={type:m.WEBRTC_OFFER,data:n,sender:f,recipient:i.current},v.send(JSON.stringify(r)),I((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!0})}));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return c.a.useEffect((function(){B(),v.addEventListener("message",function(){var t=Object(l.a)(d.a.mark((function t(n){var r,c,a,s,u,o,l,j;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=JSON.parse(n.data),c=r.type,a=r.data,s=r.sender,u=r.recipient,c===m.PEER_LIST_CHANGED&&(o=a.users.filter((function(e){return e.name.includes(L)})),_(o)),c!==m.WEBRTC_OFFER||s===f){t.next=14;break}return D(),i.current=s,t.next=7,e.current.setRemoteDescription(a);case 7:return t.next=9,e.current.createAnswer();case 9:return l=t.sent,t.next=12,e.current.setLocalDescription(l);case 12:j={type:m.WEBRTC_ANSWER,data:l,sender:u,recipient:s},v.send(JSON.stringify(j));case 14:if(c!==m.WEBRTC_ANSWER||s===f){t.next=17;break}return t.next=17,e.current.setRemoteDescription(a);case 17:c===m.ICE_CANDIDATE&&s!==f&&e.current.addIceCandidate(a),c===m.HANG_UP&&s!==f&&k();case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[]),{senderName:f,handleChangeSenderName:function(e){return h(e.target.value)},handleSelectRecipient:function(e){i.current=e,I((function(e){return Object(u.a)(Object(u.a)({},e),{},{call:!1})}))},localVideoRef:n,remoteVideoRef:r,anotherVideoRef:a,disableButtons:A,isVideoOn:C.video,isAudioOn:C.audio,handleToggleDevicesMuteStatus:function(e){return function(){return g((function(n){var r=Object(u.a)(Object(u.a)({},n),{},Object(s.a)({},e,!n[e]));return t.current.getTracks().forEach((function(t){t.kind===e&&(t.enabled=!t.enabled)})),r}))}},joinedUsers:E,handleCall:U,handleHungUp:k,handleJoinLobby:function(){var e={type:m.JOIN_LOBBY,data:"",sender:f,recipient:""};v.send(JSON.stringify(e)),I((function(e){return Object(u.a)(Object(u.a)({},e),{},{join:!0,hungUp:!0})}))}}},k=function(){var e=B();return Object(y.jsxs)(b.a,{p:2,children:[Object(y.jsxs)(f.a,{container:!0,spacing:2,justify:"center",children:[Object(y.jsx)(f.a,{item:!0,xs:4,children:Object(y.jsx)("video",{autoPlay:!0,ref:e.localVideoRef,style:{width:"100%",height:"100%"}})}),Object(y.jsx)(f.a,{item:!0,xs:4,children:Object(y.jsx)("video",{autoPlay:!0,ref:e.remoteVideoRef,style:{width:"100%",height:"100%"}})}),Object(y.jsx)(f.a,{item:!0,xs:4,children:Object(y.jsx)("video",{autoPlay:!0,ref:e.anotherVideoRef,style:{width:"100%",height:"100%"}})}),Object(y.jsxs)(f.a,{item:!0,xs:12,container:!0,spacing:2,justify:"center",children:[Object(y.jsx)(f.a,{item:!0,xs:"auto",children:Object(y.jsx)(h.a,{onClick:e.handleToggleDevicesMuteStatus("video"),children:e.isVideoOn?Object(y.jsx)(E.a,{color:"primary"}):Object(y.jsx)(_.a,{color:"error"})})}),Object(y.jsx)(f.a,{item:!0,xs:"auto",children:Object(y.jsx)(h.a,{onClick:e.handleToggleDevicesMuteStatus("audio"),children:e.isAudioOn?Object(y.jsx)(R.a,{color:"primary"}):Object(y.jsx)(T.a,{color:"error"})})})]}),Object(y.jsx)(f.a,{item:!0,xs:12,children:Object(y.jsx)(p.a,{value:e.senderName,onChange:e.handleChangeSenderName,variant:"outlined",fullWidth:!0,autoFocus:!0,disabled:e.disableButtons.join})}),Object(y.jsx)(f.a,{item:!0,xs:"auto",children:Object(y.jsx)(x.a,Object(u.a)(Object(u.a)({},I),{},{onClick:e.handleCall,disabled:e.disableButtons.call,children:"Call"}))}),Object(y.jsx)(f.a,{item:!0,xs:"auto",children:Object(y.jsx)(x.a,Object(u.a)(Object(u.a)({},I),{},{onClick:e.handleJoinLobby,disabled:e.disableButtons.join,children:e.disableButtons.join?"Joined":"Join"}))}),Object(y.jsx)(f.a,{item:!0,xs:"auto",children:Object(y.jsx)(x.a,Object(u.a)(Object(u.a)({},I),{},{onClick:e.handleHungUp,disabled:e.disableButtons.hungUp,children:"Hung up"}))})]}),Object(y.jsx)(A,{users:e.joinedUsers,myName:e.senderName,onSelectRecipient:e.handleSelectRecipient})]})},D=n(112),U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,119)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};n(71);i.a.render(Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(D.a,{}),Object(y.jsx)(k,{})]}),document.getElementById("root")),U()}},[[72,1,2]]]);
//# sourceMappingURL=main.b466ba2d.chunk.js.map